# 图文对齐优化

## 🎯 优化目标

在 ImageTextSlide（图文混合页）中，确保图片和文字在视觉上完美对齐，提升整体布局的美观性和专业性。

## ✅ 已完成的对齐优化

### 1. 左图右文布局（horizontal）

**优化内容：**

#### 改进前
- 图片高度：max_height = 5.0"
- 图片顶部：top = 1.9"
- 文字顶部：top = 1.8"
- ❌ **问题**：图片比文字低 0.1"，视觉上不对齐

#### 改进后
- 图片高度：max_height = 5.4"（与文字框高度一致）
- 图片顶部：top = 1.8"（与文字框 top 对齐）
- 文字顶部：top = 1.8"
- ✅ **效果**：图片和文字顶部完全对齐，视觉整齐

**布局示意：**
```
┌────────────────────────────────────────┐
│  标题（居中）                          │
├──────────────┬─────────────────────────┤
│              │                         │
│   [图片]     │  文字说明内容           │
│   (左侧)     │  (右侧)                 │
│   居中显示   │  左对齐                 │
│              │                         │
└──────────────┴─────────────────────────┘
    ↑ 1.8"          ↑ 1.8" (对齐！)
```

### 2. 上图下文布局（vertical）

**优化内容：**

#### 改进前
- 图片宽度：max_width = 7.0"
- 图片左侧：left = 1.5"
- 文字左侧：left = 1.0"
- ❌ **问题**：图片比文字右移 0.5"，不居中

#### 改进后
- 图片宽度：max_width = 8.0"（与文字框宽度一致）
- 图片左侧：left = 1.0"（与文字框 left 对齐）
- 文字左侧：left = 1.0"
- ✅ **效果**：图片和文字左侧对齐，整体居中

**布局示意：**
```
┌────────────────────────────────────────┐
│  标题（居中）                          │
├────────────────────────────────────────┤
│                                        │
│         [图片]                         │
│       (上方居中)                       │
│                                        │
├────────────────────────────────────────┤
│  文字说明内容（下方）                  │
│  左对齐                                │
└────────────────────────────────────────┘
    ↑ 1.0"                    
    ↑ 1.0" (对齐！)
```

## 📊 具体参数对比

### 左图右文（horizontal）

| 参数 | 改进前 | 改进后 | 说明 |
|-----|--------|--------|------|
| 图片区域宽度 | 4.4" | 4.4" | 不变 |
| 图片区域高度 | 5.0" | 5.4" | ✅ 增加，与文字框一致 |
| 图片左侧位置 | 0.7 + offset | 0.7 + offset | 不变 |
| 图片顶部位置 | 1.9 + offset | 1.8 + offset | ✅ 对齐文字框 |
| 文字框左侧 | 5.35" | 5.35" | 不变 |
| 文字框顶部 | 1.8" | 1.8" | 不变 |
| 文字框宽度 | 4.0" | 4.0" | 不变 |
| 文字框高度 | 5.4" | 5.4" | 不变 |

### 上图下文（vertical）

| 参数 | 改进前 | 改进后 | 说明 |
|-----|--------|--------|------|
| 图片区域宽度 | 7.0" | 8.0" | ✅ 增加，与文字框一致 |
| 图片区域高度 | 3.2" | 3.2" | 不变 |
| 图片左侧位置 | 1.5 + offset | 1.0 + offset | ✅ 对齐文字框 |
| 图片顶部位置 | 1.8 + offset | 1.8 + offset | 不变 |
| 文字框左侧 | 1.0" | 1.0" | 不变 |
| 文字框顶部 | 5.3" | 5.3" | 不变 |
| 文字框宽度 | 8.0" | 8.0" | 不变 |
| 文字框高度 | 1.9" | 1.9" | 不变 |

## 🎨 对齐原理

### 垂直对齐（左图右文）

```python
# 图片和文字使用相同的 top 值
picture_top = Inches(1.8 + (max_height - img_height) / 2)
text_top = Inches(1.8)

# 图片在其区域内垂直居中
# 当图片高度小于 max_height 时，会自动垂直居中
# 这样图片的视觉中心与文字的视觉中心对齐
```

### 水平对齐（上图下文）

```python
# 图片和文字使用相同的 left 值
picture_left = Inches(1.0 + (max_width - img_width) / 2)
text_left = Inches(1.0)

# 图片在其区域内水平居中
# 当图片宽度小于 max_width 时，会自动水平居中
# 这样整体布局保持居中对称
```

## 🧪 测试结果

```bash
$ python test_alignment.py

📝 處理第 1 張幻燈片...
   ✓ 添加圖片：2d04769b10cd9e2d8e1c91c44628582c.jpg (4.40" × 2.20")
   ✓ 創建成功

📝 處理第 2 張幻燈片...
   ✓ 添加圖片：7b148bf05ac7da750129072058845b3d.jpg (5.69" × 3.20")
   ✓ 創建成功

✅ PPTX 已保存：test_image_alignment.pptx
✅ 图文对齐测试完成！
```

## 💡 实际效果

### 案例 1：旅游景点介绍（左图右文）

**数据：**
```json
{
  "slide_type": "image_with_text",
  "title": "立山黑部阿爾卑斯山路線",
  "image_id": "img_01",
  "text": "立山黑部是日本最壮观的山岳观光路线之一，海拔高达3000米。每年4-6月的雪墙景观尤为壮观，高达20米的雪壁令人叹为观止。",
  "layout": "horizontal"
}
```

**效果：**
- ✅ 图片左侧显示，垂直居中
- ✅ 文字右侧显示，顶部与图片对齐
- ✅ 整体视觉平衡，专业美观

### 案例 2：产品展示（上图下文）

**数据：**
```json
{
  "slide_type": "image_with_text",
  "title": "精选美食体验",
  "image_id": "img_02",
  "text": "品尝信州牛寿喜烧御膳和岐阜名物朴叶味噌烧飞驒牛料理，体验日本顶级和牛的美味。",
  "layout": "vertical"
}
```

**效果：**
- ✅ 图片上方显示，水平居中
- ✅ 文字下方显示，与图片左对齐
- ✅ 整体布局对称，视觉舒适

## 🔍 关键改进点

### 1. 一致的区域大小

**左图右文：**
- 图片区域高度 = 文字框高度 = 5.4"
- 确保两者在垂直方向上占据相同空间

**上图下文：**
- 图片区域宽度 = 文字框宽度 = 8.0"
- 确保两者在水平方向上占据相同空间

### 2. 统一的起始位置

**左图右文：**
- 图片和文字的 top 都从 1.8" 开始
- 即使图片在区域内居中，视觉上也会对齐

**上图下文：**
- 图片和文字的 left 都从 1.0" 开始
- 即使图片在区域内居中，视觉上也会对齐

### 3. 保持宽高比

```python
img_width, img_height = self._calculate_image_size(
    image_path, max_width, max_height
)
```

- 图片会根据原始比例自动缩放
- 不会被拉伸变形
- 在限定区域内居中显示

## 📐 布局尺寸总览

### 幻灯片整体尺寸
- 宽度：10"
- 高度：7.5"

### 左图右文布局（horizontal）
```
标题区：
- 位置：(0.6", 0.5")
- 尺寸：8.8" × 0.75"

图片区：
- 位置：(0.7", 1.8")
- 最大尺寸：4.4" × 5.4"
- 实际图片：居中显示

文字区：
- 位置：(5.35", 1.8")
- 尺寸：4.0" × 5.4"

总宽度：0.7" + 4.4" + 0.25" + 4.0" + 0.65" = 10"
                                        ↑ 间距
```

### 上图下文布局（vertical）
```
标题区：
- 位置：(0.6", 0.5")
- 尺寸：8.8" × 0.75"

图片区：
- 位置：(1.0", 1.8")
- 最大尺寸：8.0" × 3.2"
- 实际图片：居中显示

文字区：
- 位置：(1.0", 5.3")
- 尺寸：8.0" × 1.9"

总高度：0.5" + 0.75" + 0.55" + 3.2" + 0.3" + 1.9" + 0.3" = 7.5"
                                ↑ 间距    ↑ 间距
```

## 🎯 设计原则

### 1. 视觉对齐优先

不是精确的数值对齐，而是视觉上的和谐对齐：
- 使用相同的起始坐标
- 使用相同的区域尺寸
- 内容在区域内居中

### 2. 保持一致性

两种布局遵循相同的设计原则：
- 统一的边距
- 统一的间距
- 统一的对齐方式

### 3. 内容优先

图片大小根据内容自适应：
- 保持原始宽高比
- 不超出限定区域
- 自动居中显示

## 📚 相关文档

- [LAYOUT_FIX_SUMMARY.md](./LAYOUT_FIX_SUMMARY.md) - 防跑版优化总结
- [NEWLINE_CENTER_FIX.md](./NEWLINE_CENTER_FIX.md) - 换行符置中优化
- [REFACTOR_SUMMARY.md](./REFACTOR_SUMMARY.md) - 重构总结

## ✨ 总结

通过统一图片和文字的区域尺寸，并确保它们使用相同的起始坐标，现在 ImageTextSlide 的两种布局都实现了完美的视觉对齐：

**左图右文：**
- ✅ 图片和文字顶部对齐
- ✅ 垂直方向视觉平衡
- ✅ 专业的并列布局

**上图下文：**
- ✅ 图片和文字左侧对齐
- ✅ 水平方向视觉居中
- ✅ 清晰的层次布局

所有改进都保持了图片的原始宽高比，确保内容不会变形，同时提供了最佳的视觉体验！

---

**版本**: 2.3  
**更新日期**: 2025-10-16  
**状态**: ✅ 完成并测试通过

